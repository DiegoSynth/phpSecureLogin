<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />

    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <script type="text/JavaScript" src="js/sha512.js"></script>
</head>

<body>
    <script type="text/javascript">
        function processLogin() {
            var password = hex_sha512($("#password").val());
            var username = $("#email").val()
            authenticateUser(username, password);
        }

        function authenticateUser(nameUser, passwordUser) {

            var url = getHostStart();
            url += '/includes/middleLayer.php';
            var requestMessage = '{"messageName":"processLogin","nameUser":"' + nameUser + '","secret":"' + passwordUser + '"}';

            var posting = $.post(url, requestMessage, null, "json");
            posting.done(function (data) {
                afterLoginProcess(data);
            });
            posting.fail(function () {
                alert("Sorry. Server unavailable. ");
            });

        }

        function getHostStart() {
            var protocol = $(location).attr('protocol');
            var hostname = $(location).attr('hostname');
            var path = $(location).attr('pathname');
            path = path.split("/")
            path.splice(path.length - 1, 1);
            path = path.join("/");

            var fullPath = protocol + "//" + hostname + path;

            return fullPath;
        }

        $(document).on('pageinit', function (event) {
            $('input').keyup(function (e) {
                if (e.keyCode == 13) {
                    $("#btn-login").click();
                }
            });
        });

        function afterLoginProcess(responseMessage) {
            if (responseMessage.status == 0) {
                $("#notification").html("Logged in: " + responseMessage.useridentifier);
            } else {
                $("#notification").html(responseMessage.msg);
            }
        }
    </script>
    <div data-role="page">
        <div data-role="header">
            <h1>Welcome To My Homepage</h1>
        </div>
        <div data-role="main" class="ui-content">
            <h2 id="notification">&nbsp;</h2>
            <form>
                <h3>Login information</h3>
                <label for="email">E-mail:</label>
                <input type="text" name="email" id="email" placeholder="e-mail ...">
                <label for="password">Password:</label>
                <input type="password" name="password" id="password" placeholder="password ...">
            </form>
            <button onclick="processLogin();" id='btn-login'>Login</button>
        </div>
    </div>
</body>

</html>
